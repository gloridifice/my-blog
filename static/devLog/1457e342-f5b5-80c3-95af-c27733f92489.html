<!DOCTYPE html><html>
  <head lang="zh_CN">
    <meta http-equiv="Content-Type" content="charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/assets/js/header.js"></script>
    <script src="/assets/katex/katex.js"></script>
<script defer src="/assets/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>    <script>document.addEventListener(&quot;DOMContentLoaded&quot;, function() {
    renderMathInElement(document.body, {
      delimiters: [
          {left: '$$', right: '$$', display: false},
      ],
      throwOnError : false
    });
});</script>
    <link rel="stylesheet" href="/assets/katex/katex.css">
    <link rel="stylesheet" href="/assets/css/reset.css">
    <link rel="stylesheet" href="/assets/css/root.css">
    <link rel="stylesheet" href="/assets/css/color_scheme_v2.dark_mode.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600;700&amp;display=swap" rel="stylesheet">
    <script src="/assets/js/highlightjs/highlight.js"></script>
    <link rel="stylesheet" href="/assets/css/layout.css">
    <link rel="stylesheet" href="/assets/css/page_content.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/color_scheme_v2.dark_mode.css">
    <link rel="stylesheet" href="/assets/css/highlightjs/github-dark.css">
    <title>ğŸ¦† ç®¡çº¿é‡æ„ã€Inputã€Egui Tilesã€Shadow Mappingï½œWgpu PBR å¼€å‘æ—¥å¿— #0001</title>
  </head>
  <body>
    <script>hljs.highlightAll();</script>
    <div class="post">
      <div class="catalogue">
        <div>
          <ul>
            <li class="h1"><a href="#heading1_0">
                <t>æ¸²æŸ“ç®¡çº¿é‡æ„</t>
              </a></li>
            <li class="h2"><a href="#heading2_0">
                <t>Target</t>
              </a></li>
            <li class="h2"><a href="#heading2_0">
                <t>ç”¨äºå¿«é€Ÿä¹¦å†™ BindGroup çš„å®</t>
              </a></li>
            <li class="h3"><a href="#heading3_0">
                <t>BindGroupLayout</t>
              </a></li>
            <li class="h3"><a href="#heading3_1">
                <t>BindGroup</t>
              </a></li>
            <li class="h1"><a href="#heading1_1">
                <t>ç®€å•çš„è¾“å…¥ Input</t>
              </a></li>
            <li class="h1"><a href="#heading1_2">
                <t>Egui Tiles</t>
              </a></li>
            <li class="h1"><a href="#heading1_3">
                <t>Shadow Mapping</t>
              </a></li>
            <li class="h1"><a href="#heading1_4">
                <t>Still a lot of problem</t>
              </a></li>
            <li class="h2"><a href="#heading2_2">
                <t>Next Station</t>
              </a></li>
          </ul>
        </div>
      </div>
      <div class="navi"><a class="navi_link" href="/home.html">ä¸»é¡µ</a><a class="navi_link" href="/blogs.html">åšå®¢</a><a class="navi_link" href="/portfolio.html">é¡¹ç›®</a><a class="navi_link" href="/about.html">å…³äº</a></div>
      <div class="sidebar_wrapper_left sidebar_wrapper"></div>
      <div class="sidebar_wrapper_right sidebar_wrapper"></div>
      <div class="contents">
        <div class="header"><a class="navi_link" href="/home.html">ä¸»é¡µ</a><a class="navi_link" href="/blogs.html">åšå®¢</a><a class="navi_link" href="/portfolio.html">é¡¹ç›®</a><a class="navi_link" href="/about.html">å…³äº</a></div>
        <div class="page_description">
          <h1 class="title">ğŸ¦† ç®¡çº¿é‡æ„ã€Inputã€Egui Tilesã€Shadow Mappingï½œWgpu PBR å¼€å‘æ—¥å¿— #0001</h1>
          <div class="sub_info">
            <p class="date">2024-12-25</p>
          </div>
        </div>
        <div class="page_content">
          <div class="image_wrapper"><img src="/devLog/1457e342-f5b5-80c3-95af-c27733f92489/img_1647e342-f5b5-80c4-98d5-f0040db5da82.png">
            <div class="caption">
              <t>æ¨¡å‹ </t>
              <t class="href" onclick="window.open('https://sketchfab.com/3d-models/mkr-lykken-91b274a40ebe46cd931235ac32ae0492')">https://sketchfab.com/3d-models/mkr-lykken-91b274a40ebe46cd931235ac32ae0492</t>
            </div>
          </div>
          <p>
            <t>ç®­å¤´ä»£è¡¨å¹³è¡Œå…‰çš„ä½ç½®å’Œæ–¹å‘ï¼ˆé»‘ç´«è‰²çš„æè´¨è¯´æ˜ Default Material æ­£å¸¸å·¥ä½œï¼‰ã€‚</t>
          </p>
          <h1 id="heading1_0">
            <t>æ¸²æŸ“ç®¡çº¿é‡æ„</t>
          </h1>
          <p>
            <t>åŸæ¥çš„ Bind Group ç®¡ç†æœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Š Bind Grop æœ€å¤šæœ‰ 4 ä¸ªã€‚ é‡æ„çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®© Bind Group çš„å®‰æ’å˜å¾—æ›´æ¥è¿‘ç°ä»£æ¸¸æˆå¼•æ“äº†ã€‚ç°åœ¨çš„ Bind Group å¦‚ä¸‹è¡¨ã€‚</t>
          </p>
          <div class="table">
            <table>
              <tr class="table_header">
                <td class="table_header">BindGroup</td>
                <td>è¯´æ˜</td>
                <td>ç›®å‰å†…å®¹</td>
              </tr>
              <tr>
                <td class="table_header">0: Global</td>
                <td>å…¨å±€èµ„æºï¼Œä¾‹å¦‚ç›¸æœºã€å¹³è¡Œå…‰ã€Shadow map</td>
                <td>[0] Camera Buffer
[1] Global Light Uniform
[2] Shadow Map Texture2D
[3] Shadow Map Sampler</td>
              </tr>
              <tr>
                <td class="table_header">1: Material</td>
                <td>æè´¨çš„èµ„æºï¼Œä¾‹å¦‚è´´å›¾ç­‰</td>
                <td>[0] Texture 0
[1] Sampler 0</td>
              </tr>
              <tr>
                <td class="table_header">2: Object</td>
                <td>æ¯ä¸ª MeshRenderer çš„èµ„æºï¼Œä¾‹å¦‚ Transform</td>
                <td>[0] Transform Buffer</td>
              </tr>
            </table>
          </div>
          <h2 id="heading2_0">
            <t>Target</t>
          </h2>
          <p>
            <t>ç°åœ¨æ¸²æŸ“çš„å›¾åƒè¾“å‡ºåˆ°äº†ä¸€å¼ è´´å›¾ä¸Šï¼Œç”¨ Bevy ä¸­çš„ Resource ç®¡ç†ã€‚ä¹Ÿå› æ­¤èƒ½å®ç°æ¸²æŸ“åˆ° Egui çš„å›¾åƒä¸Šã€‚ç›®å‰æ¸²æŸ“çš„ Target åˆ†ä¸¤å¼  Color å’Œ Depth.</t>
          </p>
          <h2 id="heading2_1">
            <t>ç”¨äºå¿«é€Ÿä¹¦å†™ BindGroup çš„å®</t>
          </h2>
          <p>
            <t>ä¸ºäº†å¿«é€Ÿä¹¦å†™ BindGroup å’Œ BindGroupLayoutï¼Œå†™äº†ä¸¤ä¸ªå£°æ˜å®ã€‚</t>
          </p>
          <h3 id="heading3_0">
            <t>BindGroupLayout</t>
          </h3>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">#[macro_export]
macro_rules! bg_layout_descriptor {
    ([$name:literal] $($i:literal: $vis:expr =&gt; $c:expr;)*) =&gt; {
        wgpu::BindGroupLayoutDescriptor {
            label: Some($name),
            entries: &amp;[
                $($c.into_bgl_entry($i, $vis),)*
            ]
        }
    };

    () =&gt; ()
}</code></pre>
            </div>
            <div class="caption">
              <t>å®ç°</t>
            </div>
          </div>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">let material_bind_group_layout =
  Arc::new(device.create_bind_group_layout(&amp;bg_layout_descriptor!(
    [&quot;Material Bind Group Layout&quot;]
    0: ShaderStages::FRAGMENT =&gt; BGLEntry::Tex2D(false, TextureSampleType::Float { filterable: true });
    1: ShaderStages::FRAGMENT =&gt; BGLEntry::Sampler(SamplerBindingType::Filtering);
)));</code></pre>
            </div>
            <div class="caption">
              <t>ä½¿ç”¨</t>
            </div>
          </div>
          <p>
            <t>å…¶ä¸­ï¼Œä¸ºäº†ä¾¿äºä¹¦å†™ï¼Œæˆ‘å°† </t>
            <t class="code">BindGroupEntry</t>
            <t> å°è£…æˆäº†ä¸€ä¸ªæšä¸¾ç±»å‹ </t>
            <t class="code">BGLEntry</t>
            <t> ã€‚</t>
          </p>
          <h3 id="heading3_1">
            <t>BindGroup</t>
          </h3>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">#[macro_export]
macro_rules! bg_descriptor {
    ([$name:literal] [$layout:expr] $($i:literal: $c:expr;)*) =&gt; {
        wgpu::BindGroupDescriptor {
            label: Some($name),
            layout: $layout,
            entries: &amp;[
                $(wgpu::BindGroupEntry{
                    binding: $i,
                    resource: $c,
                },)*
            ]
        }
    };
}</code></pre>
            </div>
            <div class="caption">
              <t>å®ç°</t>
            </div>
          </div>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">let bind_group_layout =
  Arc::new(device.create_bind_group_layout(&amp;bg_layout_descriptor! (
    [&quot;Global Bind Group Layout&quot;]
    0: ShaderStages::VERTEX =&gt; BGLEntry::UniformBuffer(); // Camera Uniform
    1: ShaderStages::all() =&gt; BGLEntry::UniformBuffer(); // Global Light Uniform
    2: ShaderStages::FRAGMENT =&gt; BGLEntry::Tex2D(false, TextureSampleType::Depth); // Shadow Map
    3: ShaderStages::FRAGMENT =&gt; BGLEntry::Sampler(SamplerBindingType::Comparison); // Shadow Map
)));</code></pre>
            </div>
            <div class="caption">
              <t>ä½¿ç”¨</t>
            </div>
          </div>
          <h1 id="heading1_1">
            <t>ç®€å•çš„è¾“å…¥ Input</t>
          </h1>
          <p>
            <t>ç°åœ¨å®ç°äº†ä¸€ä¸ªç®€å•çš„è¾“å…¥å°è£…ï¼Œç”±ä¸€ä¸ªå« Input çš„ Resource ç®¡ç†ã€‚å¯ä»¥ç”¨ Unity Input çš„é£æ ¼æ¥æ£€æµ‹é”®ç›˜è¾“å…¥ã€é¼ æ ‡ä½ç§»ã€é¼ æ ‡ä½ç½®å’Œé¼ æ ‡æŒ‰é”®ã€‚</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">pub struct Input {
    pub down_keys: HashSet&lt;KeyCode&gt;,
    pub hold_keys: HashSet&lt;KeyCode&gt;,
    pub up_keys: HashSet&lt;KeyCode&gt;,
    pub last_cursor_position: Vec2,
    pub cursor_position: Vec2,
    pub cursor_offset: Vec2,
    pub down_cursor_buttons: HashSet&lt;CursorButton&gt;
}</code></pre>
            </div>
            <div class="caption"></div>
          </div>
          <p>
            <t>ç”¨èµ·æ¥æ˜¯è¿™æ ·ï¼š</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">    let mut move_vec = Vector3::new(0., 0., 0.);
    if input.is_key_hold(KeyCode::KeyW) {
        move_vec += Vector3::new(0.0, 0.0, -1.0);
    }
    ...
    if input.is_key_hold(KeyCode::Space) {
        if input.is_key_hold(KeyCode::ShiftLeft) {
            move_vec += Vector3::new(0.0, -1.0, 0.0);
        } else {
            move_vec += Vector3::new(0.0, 1.0, 1.0);
        }
    }
    let delta_time_sec = time.delta_time.as_secs_f32();
    if move_vec != Vector3::new(0., 0., 0.) {
        move_vec =
            cam_transform.rotation.rotate_vector(move_vec.normalize()) * speed * delta_time_sec;
        cam_transform.position += move_vec;
    }</code></pre>
            </div>
            <div class="caption">
              <t>ç›¸æœºæ§åˆ¶çš„éƒ¨åˆ†ä»£ç </t>
            </div>
          </div>
          <p>
            <t>æˆ‘ä»¬çš„ render å’Œå„ç±» update å‡½æ•°è°ƒç”¨å‘ç”Ÿåœ¨åœ¨ winit ä¸­çš„ </t>
            <t class="code">RedrawRequested</t>
            <t> äº‹ä»¶æ—¶ï¼Œè€Œå„ç±»è¾“å…¥äº‹ä»¶ä¸ </t>
            <t class="code">RedrawRequested</t>
            <t> äº‹ä»¶åŒå±äºä¸€ä¸ªæšä¸¾ï¼Œå®ƒä»¬å¯èƒ½åœ¨ä¸¤æ¬¡ </t>
            <t class="code">RedrawRequested</t>
            <t> ä¸­é—´ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬æƒ³ä¿è¯åœ¨ update ä¸­ä½¿ç”¨ Input æ˜¯ç¨³å®šçš„ï¼Œæˆ‘ä»¬çš„ Input ä¸€éƒ¨åˆ†éœ€è¦åœ¨äº‹ä»¶æ›´æ–°ä¸­æ›´æ–°ï¼ˆWindowEventï¼‰ï¼Œä¸€éƒ¨åˆ†è¦åœ¨å„ç§ update ä¸­æ›´æ–°ã€‚å¦‚ä¸‹è¡¨ã€‚</t>
          </p>
          <div class="table">
            <table>
              <tr>
                <td class="table_header">æ›´æ–°æ—¶åˆ»</td>
                <td>æ›´æ–°å†…å®¹</td>
              </tr>
              <tr>
                <td class="table_header">WindowEvent</td>
                <td>æ’å…¥ down_keys, up_keysï¼Œæ’å…¥å’Œåˆ é™¤ hold_keys</td>
              </tr>
              <tr>
                <td class="table_header">pre_update</td>
                <td>æ›´æ–° cursor_offset, last_cursor_position</td>
              </tr>
              <tr>
                <td class="table_header">post_update</td>
                <td>æ¸…é™¤ down_keys, up_keys</td>
              </tr>
            </table>
          </div>
          <p></p>
          <h1 id="heading1_2">
            <t>Egui Tiles</t>
          </h1>
          <div class="image_wrapper"><img src="/devLog/1457e342-f5b5-80c3-95af-c27733f92489/img_1647e342-f5b5-8023-b696-c0b4869365c6.png">
            <div class="caption">
              <t>å›¾æ¥è‡ªå®˜æ–¹ github é¡µ </t>
              <t class="href" onclick="window.open('https://github.com/rerun-io/egui_tiles')">https://github.com/rerun-io/egui_tiles</t>
            </div>
          </div>
          <p>
            <t class="href" onclick="window.open('https://github.com/rerun-io/egui_tiles')">egui_tiles</t>
            <t> æ˜¯ä¸€ä¸ªä¸º egui GUI åº“å®ç°æ ‡ç­¾é¡µåŠŸèƒ½çš„åº“ã€‚ä¸ä¹‹åŠŸèƒ½ç±»ä¼¼çš„åº“è¿˜æœ‰ </t>
            <t class="href" onclick="window.open('https://github.com/Adanos020/egui_dock')">egui_dock</t>
            <t>ï¼Œæˆ‘æ­¤å‰ä½¿ç”¨è¿‡ï¼Œæ„Ÿè§‰ä¸é”™ã€‚ä¸ºäº†å°è¯•æ–°çš„åº“ï¼Œè¿˜æ˜¯åœ¨è¿™ä¸ªé¡¹ç›®ä½¿ç”¨äº† egui_tiles. ä½¿ç”¨ä¸‹æ¥æ„Ÿè§‰è¿˜æ˜¯ egui_dock æ›´å¥½ä¸Šæ‰‹ä¸€äº›ï¼Œæä¾›çš„åŠŸèƒ½ä¹Ÿæ›´ä¸°å¯Œã€‚</t>
          </p>
          <p>
            <t>åœ¨æœ¬å¼€å‘æ—¥å¿—çš„å¤´å›¾ä¸Šä½ å·²ç»å¯ä»¥çœ‹åˆ°ç¨‹åºæœ‰ä¾§è¾¹æ å’Œæ ‡ç­¾é¡µç”¨äºæ§åˆ¶ç›¸æœºå’Œç¯å…‰çš„å‚æ•°äº†ã€‚</t>
          </p>
          <p>
            <t>egui_tiles å°†æ¯ä¸€ä¸ªæœ‰å†…å®¹çš„éƒ¨åˆ†ç§°ä¸º Paneï¼Œå°†æ ‡ç­¾é¡µç§°ä¸º Tabï¼Œæ¯ä¸ªæ ‡ç­¾é¡µæœ‰ä¸åŒçš„å¸ƒå±€ã€‚è€Œæ•´ä¸ªæ ‡ç­¾é¡µçš„æ ‘çš„ä¸Šä¸‹æ–‡ç§°ä¸º Behavior. Behavior åŒæ—¶æ˜¯ä¸€ä¸ª traitï¼Œæˆ‘ä»¬æ¯ä¸ª Pane çš„ ui è¡Œä¸ºè¦åœ¨å…¶å®ç°ä¸­ä¹¦å†™ã€‚æˆ‘ä»¬å¯ä»¥æšä¸¾çš„æ–¹å¼å£°æ˜ Pane. ä¾‹å¦‚ï¼š</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">pub enum MyPane {
    MainView,
    ControlPanel,
}</code></pre>
            </div>
            <div class="caption"></div>
          </div>
          <p>
            <t>æˆ‘ä»¬åœ¨å®ç° Behavior éœ€è¦ç¡®å®š Pane æ³›å‹ï¼ˆä¸‹é¢çš„ç¤ºä¾‹ä¸­ä¸º </t>
            <t class="code">MyPane</t>
            <t>ï¼‰ã€‚</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">struct MyBehavior&lt;'a&gt; {
    world: &amp;'a mut World, //è¿™é‡Œçš„ World æ˜¯ bevy_ecs ä¸­çš„ Wroldï¼Œæˆ‘ä»¬å®ç° ui çš„æ—¶å€™éœ€è¦ç”¨å®ƒ
}

impl&lt;'a&gt; egui_tiles::Behavior&lt;MyPane&gt; for MyBehavior&lt;'a&gt; {
    fn pane_ui(&amp;mut self, ui: &amp;mut egui::Ui, ..., pane: &amp;mut MyPane) -&gt; egui_tiles::UiResponse {
        match pane {
          ...
        };
        egui_tiles::UiResponse::None
    }
    
    fn tab_title_for_pane(&amp;mut self, pane: &amp;Pane) -&gt; egui::WidgetText {
        match pane {
            Pane::MainView =&gt; &quot;Main View&quot;.into(),
            Pane::ControlPanel =&gt; &quot;Control Panel&quot;.into(),
        }
    }
}</code></pre>
            </div>
            <div class="caption"></div>
          </div>
          <p>
            <t>åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰æˆ‘ä»¬çš„æ ‡ç­¾é¡µä»¬çš„æ ‘ç»“æ„ï¼š</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">fn create_tree() -&gt; egui_tiles::Tree&lt;MyPane&gt; {
    let mut tiles = egui_tiles::Tiles::default();

    let mut left_tabs_id_vec = vec![];
    let control_pane = tiles.insert_pane(MyPane::ControlPanel);
    let main_view_pane = tiles.insert_pane(MyPane::MainView);
    left_tabs_id_vec.push(tiles.insert_vertical_tile(vec![control_pane]));
    left_tabs_id_vec.push(tiles.insert_vertical_tile(vec![main_view_pane]));

    let left_tabs = tiles.insert_tab_tile(left_tabs_id_vec);

    let root = tiles.insert_horizontal_tile(vec![left_tabs]);

    egui_tiles::Tree::new(&quot;main_tree&quot;, root, tiles)
}</code></pre>
            </div>
            <div class="caption"></div>
          </div>
          <p>
            <t>æœ€ååœ¨éœ€è¦çš„ä½ç½®è°ƒç”¨æ¸²æŸ“å°±å¯ä»¥äº†ï¼š</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">...
let mut tree = create_tree();
let mut behavior = TreeBehavior { world };
tree.ui(&amp;mut behavior, ui);
...</code></pre>
            </div>
            <div class="caption"></div>
          </div>
          <p>
            <t>æ›´å¤šä½¿ç”¨æ¡ˆä¾‹è§ egui_tiles github é¡µçš„ </t>
            <t class="href" onclick="window.open('https://github.com/rerun-io/egui_tiles/tree/main/examples')">examples</t>
            <t>.</t>
          </p>
          <p></p>
          <h1 id="heading1_3">
            <t>Shadow Mapping</t>
          </h1>
          <p>
            <t>Shadow Mapping çš„åŸºæœ¬åŸç†æ˜¯åœ¨å‰ä¸€ Pass ä»ç¯å…‰çš„è§†è§’æ¸²æŸ“ä¸€å¼ æ·±åº¦å›¾ï¼Œå†åœ¨ä¸» Pass ä¸­é€šè¿‡ç”¨è¿™å¼ æ·±åº¦å›¾é‡‡æ ·ï¼Œè·å¾—ä»ç¯å…‰çœ‹å‘ä¸–ç•Œæ—¶çš„ç‰‡æºçš„æœ€æµ…æ·±åº¦ã€‚å°†è¿™ä¸ªæœ€æµ…æ·±åº¦ä¸æŸä¸ªç‰‡æºåœ¨ç¯å…‰ç©ºé—´çš„å®é™…æ·±åº¦å¯¹æ¯”ã€‚å¦‚æœå®é™…æ·±åº¦æ›´æ·±è¯´æ˜å…¶åœ¨é˜´å½±ä¸­ã€‚ç†è®ºå’Œå®è·µéƒ½å¯ä»¥å‚è€ƒè¯¥æ–‡ç« ï¼š</t>
            <t class="href" onclick="window.open('https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping')">https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping</t>
          </p>
          <p>
            <t>ç®€å•è¯´ä¸€ä¸‹æˆ‘çš„å®è·µè¿‡ç¨‹å’Œè¸©çš„å‘ã€‚</t>
          </p>
          <p>
            <t>é¦–å…ˆè¦ä¸ºç®¡çº¿å¢åŠ ä¸€ä¸ªæ–°çš„ Pass æ¸²æŸ“ç¯å…‰ç©ºé—´çš„æ·±åº¦å›¾ï¼Œåœ¨è¿™ä¸ª Pass ä½¿ç”¨ç¯å…‰çš„çŸ©é˜µå’Œç‰©ä½“çš„ Transform Buffer. è¿™ä¸ªè¿‡ç¨‹éœ€è¦è®¡ç®—ç¯å…‰çš„å˜æ¢çŸ©é˜µï¼ˆView Projection åæ–‡ç®€ç§° VPï¼‰ï¼Œæˆ‘è¸©äº†ç¬¬ä¸€ä¸ªå‘ã€‚æˆ‘ç”¨çš„æ•°å­¦åº“ cgmath æ˜¯ä¸º OpenGL è®¾è®¡çš„ï¼Œåœ¨ OpenGL ä¸­çŸ©é˜µæ˜¯ column major çš„ï¼Œä½†æ˜¯ wgpu çš„çŸ©é˜µé»˜è®¤æ˜¯ row major çš„ã€‚è¿™å¯¼è‡´æˆ‘ä¼ å…¥ç€è‰²å™¨çš„çŸ©é˜µå§‹ç»ˆæ˜¯æœ‰é—®é¢˜çš„ã€‚å¥½åœ¨æœ€åå‘ç°äº†ï¼Œè½¬ç½®ä¸€ä¸‹å³å¯ã€‚</t>
          </p>
          <blockquote>
            <t>å…³äºè®¡ç®—æœºçŸ©é˜µè¡¨è¾¾çš„ Column Major å’Œ Row Major å¯ä»¥è§è¿™ç¯‡æ–‡ç« ï¼š</t>
            <t class="href" onclick="window.open('http://davidlively.com/programming/graphics/opengl-matrices/row-major-vs-column-major/')">http://davidlively.com/programming/graphics/opengl-matrices/row-major-vs-column-major/</t>
          </blockquote>
          <p>
            <t>æ¥ç€å°±æ˜¯åœ¨ä¸» Pass ä¸­æ¸²æŸ“ Shadow äº†ã€‚é™¤äº†è¦ä¼  Shadow Map çš„è´´å›¾å’Œ Sampler å¤–ï¼Œè¿˜æœ‰ä¼ ç¯å…‰çš„è¡¨æ¢çŸ©é˜µã€‚æˆ‘åœ¨ </t>
            <t class="code">VertexOutput</t>
            <t> ä¸­æ–°å¢ä¸€ä¸ªå­—æ®µ </t>
            <t class="code">light_space_clip_pos</t>
            <t>.</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">...
out.light_space_clip_pos = light.view_proj * vec4&lt;f32&gt;(out.world_pos, 1.0);
...</code></pre>
            </div>
            <div class="caption">
              <t>vertex shader of main pass</t>
            </div>
          </div>
          <p>
            <t>ç„¶ååœ¨ç‰‡æºç€è‰²å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ </t>
            <t class="code">light_space_clip_pos</t>
            <t> è®¡ç®—å‡ºé‡‡æ · Shadow Map çš„ uv å’Œå½“å‰ç‰‡æºåœ¨ç¯å…‰ç©ºé—´çš„æ·±åº¦ã€‚</t>
          </p>
          <div class="code_block">
            <div class="code_part">
              <div class="code_lang">rust</div>
              <pre><code class="language-rust">...
var light_space_pos = in.light_space_clip_pos;
var proj_coords = light_space_pos.xyz / light_space_pos.w;

let flip_correction = vec2&lt;f32&gt;(0.5, -0.5);

var uv = proj_coords.xy * flip_correction + vec2&lt;f32&gt;(0.5); // reverse y and map [-1, 1] to [0, 1]
var shadow = textureSampleCompare(tex_shadow_map, samp_shadow_map, uv, proj_coords.z);
...</code></pre>
            </div>
            <div class="caption">
              <t>fragment shader of main pass</t>
            </div>
          </div>
          <p>
            <t>è¿™é‡Œéœ€è¦ flip_correction å°† y åè½¬ï¼Œè¿™æ˜¯æˆ‘è¸©ç¬¬äºŒä¸ªå‘çš„åœ°æ–¹ã€‚å› ä¸º NDC çš„åŸç‚¹åœ¨å·¦ä¸‹è§’ y æœä¸Šï¼Œè€Œæè´¨ uv çš„åŸç‚¹æ˜¯ä»å·¦ä¸Šè§’ï¼Œy æœä¸‹ï¼Œå› æ­¤éœ€è¦åè½¬ä¸€ä¸‹ã€‚ä¹˜ 0.5 å’ŒåŠ  0.5 å°† NDC çš„ xy èŒƒå›´ [-1,1] æ˜ å°„ uv çš„èŒƒå›´ [0,1]. Wgpu çš„ NDC çš„ z çš„èŒƒå›´æ˜¯ [0,1]ï¼Œå› æ­¤ä¸éœ€è¦åšé¢å¤–å¤„ç†ã€‚å°†å…¶å¤„ä»¥ w åçš„å€¼ä½œä¸ºå½“å‰ç‰‡æºåœ¨ç›¸æœºç©ºé—´ä¸‹çš„æ·±åº¦ã€‚</t>
          </p>
          <p>
            <t>æœ‰å…³ç®¡çº¿ã€é‡‡æ ·å™¨ã€æ·±åº¦è´´å›¾çš„é…ç½®ç­‰ï¼ŒWgpu çš„ example æä¾›äº† shadow å®ç°ï¼Œå¯ä»¥é˜…è¯»ï¼š </t>
            <t class="href" onclick="window.open('https://github.com/gfx-rs/wgpu/tree/trunk/examples/src/shadow')">https://github.com/gfx-rs/wgpu/tree/trunk/examples/src/shadow</t>
          </p>
          <h1 id="heading1_4">
            <t>Still a lot of problem</t>
          </h1>
          <p>
            <t>æˆ‘æœ¬ä»¥ä¸º Shadow Mapping æ˜¯æ—©å‘æ˜ä¸”æˆç†Ÿçš„æŠ€æœ¯ï¼Œç»“æœå‘ç°æƒ³è¦å®ç°æ•ˆæœå¥½è¿˜æ˜¯è¦åšå¾ˆå¤šå·¥ä½œã€‚ç›®å‰æˆ‘åªå®ç°äº†å¹³è¡Œå…‰çš„ Shadow Mapping. åç»­è¿˜è¦ä¼˜åŒ–ï¼Œåˆ—ä¸€ä¸‹æˆ‘è¿˜éœ€è¦åšçš„å†…å®¹ï¼š</t>
          </p>
          <ul>
            <li>
              <t>Cascaded Shadow Mapping (CSM)ï¼š
CSM å°†ç©å®¶èƒ½çœ‹åˆ°çš„è§†é‡èŒƒå›´åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†åˆ†åˆ«ç”¨å•ç‹¬çš„ Shadow Map è¦†ç›–ã€‚æ—¨åœ¨è§£å†³å¹³è¡Œå…‰ Shadow Mapping çš„è§†è§’é—®é¢˜ã€åˆ©ç”¨ç‡é—®é¢˜å’Œç²¾åº¦é—®é¢˜ã€‚
</t>
              <t class="href" onclick="window.open('https://learnopengl.com/Guest-Articles/2021/CSM')">https://learnopengl.com/Guest-Articles/2021/CSM</t>
            </li>
          </ul>
          <ul>
            <li>
              <t>å¤šå…‰æº Shadow Mappingï¼š
ç”¨ texture array å®ç°å°±å¥½äº†ï¼Œæ¯ä¸ªå…‰æºå¯¹åº”ä¸€å¼  Shadow Map. Wgpu çš„ </t>
              <t class="href" onclick="window.open('https://github.com/gfx-rs/wgpu/tree/trunk/examples/src/shadow')">examples ä¸­çš„ shadow</t>
              <t> å°±æ˜¯ä¸€ä¸ªå¤šå…‰æºå®ç°ï¼Œå¾ˆå¥½çš„å‚è€ƒã€‚</t>
            </li>
          </ul>
          <ul>
            <li>
              <t>å¤šå…‰æºç±»å‹ï¼š
å„ç§å…‰æºç±»å‹ä¸‹çš„æŠ•å½±çŸ©é˜µå¦‚ä½•è®¾ç½®ä¹Ÿæ˜¯ä»¶éœ€è¦èŠ±ä¸€äº›æ—¶é—´ç ”ç©¶çš„äº‹ã€‚</t>
            </li>
          </ul>
          <ul>
            <li>
              <t>Percentage-Closer Soft Shadows (PCSS):
éšè·ç¦»å˜åŒ–çš„è½¯é˜´å½±ã€‚</t>
            </li>
          </ul>
          <ul>
            <li>
              <t>åèµ°æ ·ï¼š
ç›®å‰æˆ‘è¿˜æ²¡æœ‰å¤ªå¤šäº†è§£ï¼Œä¹‹åä¼šæŸ¥ä¸€äº›èµ„æ–™ã€‚å®è·µååˆ‡èº«è®¤è¯†åˆ° Shadow Mapping çš„åèµ°æ ·é‡è¦æ€§ï¼Œç›®å‰çš„ç¨‹åºæ—¶å¸¸èµ°æ ·åœ°å¯æ€•ã€‚</t>
              <div class="image_wrapper"><img src="/devLog/1457e342-f5b5-80c3-95af-c27733f92489/img_1647e342-f5b5-808c-bcbc-ffdada5a1e5b.png">
                <div class="caption"></div>
              </div>
            </li>
          </ul>
          <p></p>
          <h2 id="heading2_2">
            <t>Next Station</t>
          </h2>
          <p>
            <t>ä¸è¿‡æˆ‘åœ¨ Shadow Mapping ä¸Šè€—è´¹äº†å¤ªå¤šç²¾åŠ›ï¼ˆå› ä¸ºä¸€äº›å¯¹åº“å’ŒçŸ©é˜µä¸ç†Ÿæ‚‰å¯¼è‡´çš„é—®é¢˜ï¼‰ã€‚æ‰“ç®—å…ˆæ”¾ä¸€æ”¾ï¼Œåšä¸€äº›å…¶å®ƒå·¥ä½œæ¢æ¢å£å‘³æ¯”è¾ƒå¥½ã€‚æœ€è¿‘çš„æƒ³æ³•æ˜¯å…ˆå°† SSAO (Screen Space Ambient Occlusion) å®ç°äº†å§ï¼å¦‚æœå¯ä»¥ï¼Œä¹Ÿä¿®ä¸€ä¸‹æ³•çº¿å˜æ¢é—®é¢˜å§ [</t>
            <t class="href" onclick="window.open('https://terathon.com/blog/transforming-normals.html')">Transforming Normal</t>
            <t>]ï¼Œä¿®å®Œæ³•çº¿åè¯´ä¸å®šå¯ä»¥æŠŠ HBAO (Horizon-Based Ambient Occlusion) å®ç°äº†ã€‚åš SSAO è¦å†™ä¸€ä¸‹åå¤„ç†ç®¡çº¿ï¼Œé‚£ä¹ˆä¹‹åå¯ä»¥æŠŠ MSAA å®ç°äº†ã€‚</t>
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
